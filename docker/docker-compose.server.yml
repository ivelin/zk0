services:
  superlink:
    image: flwr/superlink:1.23.0
    command: ["--insecure", "--isolation", "process"]
    ports:
      - "9091:9091"  # ServerAppIO API
      - "9092:9092"  # Fleet API
      - "9093:9093"  # Control API
    deploy:
      resources:
        limits:
          memory: 8G
        reservations:
          memory: 4G
    networks:
      - flwr-network

  zk0-server:
    build:
      context: .
      dockerfile: docker/Dockerfile.zk0
    image: zk0:latest
    deploy:
      resources:
        limits:
          memory: 16G
        reservations:
          memory: 8G
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    command: ["--insecure", "--plugin-type", "serverapp", "--appio-api-address", "superlink:9091"]
    volumes:
      - ../outputs:/workspace/outputs
      - ${HOME}/.cache/huggingface:/home/user_zk0/.cache/huggingface
    depends_on:
      - superlink
    networks:
      - flwr-network

networks:
  flwr-network:
    external: true